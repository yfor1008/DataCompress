# 截断二进制编码

**截断二进制编码([Truncated Binary Encoding](https://en.wikipedia.org/wiki/Truncated_binary_encoding))**

是一种适用于均匀分布的熵编码. 当符号个数不为2的整数次幂时, 比普通固定长度的二进制编码效果好, 能缩短平均码长.

**基本原理**

设需要编码数据的个数为`n`, `k1=floor(log2(n))(向下取整)`, `k2=ceil(log2(n))(向上取整)`, `u=2^(k1+1)-n`, 则编码方式为: 对于前`u`个数, 使用`k1`个bit进行二进制编码; 对于后面`n-u`个数, 加上`u`后, 使用`k2`个bit进行二进制编码.

对于`n`, 这里有2种情况:
- `n`为2的幂次: `k1=k2`, `u=2^(k1+1)-n=n*2-n=n`, 因而所有数据使用`k1(k2)`个bit进行二进制编码;
- `n`不为2的幂次: `k2=k1+1`, `u<n`, 因而前`u`个数, 使用`k1`个bit进行二进制编码; 对于后面`n-u`个数, 加上`u`后, 使用`k1+1`个bit进行二进制编码.

**编码示例**

data | index | offset | offset value | Standard Binary | Truncated Binary 
 :-: | :-: | :-: | :-: | :-: | :-: 
 s0 | 0 | 0 | 0 | ~~0~~000 | 000 
 s1 | 1 | 0 | 1 | ~~0~~001 | 001 
 s2 | 2 | 0 | 2 | ~~0~~010 | 010 
 s3 | 3 | 0 | 3 | ~~0~~011 | 011 
 s4 | 4 | 0 | 4 | ~~0~~100 | 100 
 s5 | 5 | 0 | 5 | ~~0~~101 | 101 
 **s6** | **6** | **6** | **12** | **0110** | **1100** 
 **s7** | **7** | **6** | **13** | **0111** | **1101** 
 **s8** | **8** | **6** | **14** | **1000** | **1110** 
 **s9** | **9** | **6** | **15** | **1001** | **1111** 

